map $http_upgrade $connection_upgrade { default upgrade; '' close; }
server { listen 80; server_name odanielsoares.tech www.odanielsoares.tech; return 301 https://; }
server { listen 443 ssl; server_name odanielsoares.tech www.odanielsoares.tech; ssl_certificate /etc/letsencrypt/live/odanielsoares.tech/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/odanielsoares.tech/privkey.pem; location = /ws { proxy_pass http://127.0.0.1:4000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_read_timeout 120s; proxy_send_timeout 120s; } location ~* ^/(sessions|chat) { return 403; } location / { proxy_pass http://127.0.0.1:3000; proxy_http_version 1.1; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } }
